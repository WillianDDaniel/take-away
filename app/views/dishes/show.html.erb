<h1><%= @dish.name %></h1>

<% if @dish.description %>
    <p><%= @dish.description %></p>
<% end %>

<p>
  <strong>Imagem:</strong>
  <% if @dish.image.attached? %>
    <%= image_tag @dish.image %>
  <% else %>
    <p>Nenhuma imagem disponível.</p>
  <% end %>
</p>

<%= @dish.calories %>

<% if @dish.portions.any? %>
  <ul>
    <% @dish.portions.each do |portion| %>
      <li><%= portion.description %></li>
      <li><%= number_to_currency(portion.price) %></li>
      <li><%= link_to 'Editar porção', edit_dish_portion_path(@dish, portion) %></li>
    <% end %>
  </ul>
<% else %>
  <p>Nenhuma porção disponível.</p>
<% end %>

<%= link_to "Editar Prato", edit_dish_path(@dish) %>
<%= button_to "Excluir Prato", @dish, method: :delete, data: { confirm: "Tem certeza?" } %>

<%= button_to "#{@dish.active? ? 'Pausar' : 'Ativar'} vendas",
  toggle_status_dish_path(@dish), method: :patch
%>

<%= link_to "Adicionar porção", new_dish_portion_path(@dish) %>

<h3>Histórico de Preços</h3>

<table>
  <thead>
    <tr>
      <th>Porção</th>
      <th>Preço anterior</th>
      <th>Atualizado em</th>
    </tr>
  </thead>
  <tbody>
    <% @dish.portions.each do |portion| %>

      <% portion.price_histories.each do |price_history| %>
        <tr>
          <td>
            <%= portion.description %>
          </td>
          <td>
            <%= number_to_currency(price_history.price) %>
          </td>
          <td>
            <%= I18n.l(price_history.updated_at.to_date) %>
          </td>
        </tr>
      <% end %>

    <% end %>
  </tbody>
</table>


